PKG_CPPFLAGS = -pthread
PKG_LIBS = -pthread

# Uncomment to enable thread assertions
# PKG_CPPFLAGS += -DDEBUG_THREAD -UNDEBUG

# Does this platform support C11's <threads.h>? Note that not all C11
# compilers and pthread libraries support <threads.h>, and that compilers that
# use older standards (like C99) sometimes do support <threads.h>.
THREADS_H_SUPPORT=$(shell ./threads_h_support.sh)

ifeq ($(THREADS_H_SUPPORT), 1)
PKG_CPPFLAGS += -DTHREADS_H_SUPPORT
PKG_CFLAGS += -DTHREADS_H_SUPPORT
else
PKG_LIBS += ./tinycthread/tinycthread.o
EXTRA_OBJECTS += ./tinycthread/tinycthread.o
endif


$(SHLIB): $(EXTRA_OBJECTS) threads_h_support


threads_h_support:
	echo THREADS_H_SUPPORT is $(THREADS_H_SUPPORT)

clean:
	rm -f thread_support.txt
